# Схема выборки данных

> [!WARNING]  
> На данный момент этот раздел вики претерпевает рефакторинг, в связи с тем, что мы некорректно интерпретировали положение схемы PAR (Picture Address Register). То что раньше назвалось "PatGen" - это на самом деле PAR,
> а то что раньше называлось PAR - это на самом деле не показанный в патенте адресный мультиплексор (который мы решили назвать нехитро - PPU Address Mux, PAMUX).
> Кроме этого "PAR Counters" теперь называются "Tile Counters", т.к. ничего общего с PAR они не имеют.
> Также мы планируем дать более понятные и адкеватные названия для некоторых сигналов (но уже после рефакторинга вики).
> Со временем, когда будет сделана вычитка всех правок и мы убедимся что нет ошибок переименования данная плашка будет также удалена.

В патенте PPU эта схема упоминается как `Still Picture Generator`.

Схема занимает почти четверть площади PPU и находится в правом нижнем углу микросхемы:

![ppu_locator_dataread](/BreakingNESWiki/imgstore/ppu/ppu_locator_dataread.jpg)

Эта схема занимается выборкой строки тайла из 8 точек, на основе scroll-регистров, которые задают положение тайла в name table и точного (fine) смещения начальной точки внутри тайла.
Результаты (текущая точка тайла) передаются в мультиплексор, для смешивания с текущей точкой спрайта.

Также схема занимается получением паттернов спрайтов и их V инверсией (схема H инверсии находится в [OAM FIFO](fifo.md)).

Ввиду большого размера показать всю схему будет затруднительно, поэтому естественным образом распилим её на составные части.

Ниже показано из каких схем состоит Data Reader, чтобы понимать где искать напиленные куски схем:

![ppu_dataread_sections](/BreakingNESWiki/imgstore/ppu/ppu_dataread_sections.jpg)

![DataReader_All](/BreakingNESWiki/imgstore/ppu/DataReader_All.png)

## Остальное

Все части схемы находятся в соответствующих разделах:

- [Picture Address Register (PAR) и V.INV](par.md)
- [Регистры скроллинга](scroll_regs.md)
- [Счётчики тайлов](tilecnt.md)
- [Мультплексор финального PPU адреса](pamux.md)
- [Схема получения цвета бэкграунда](bgcol.md)